<!DOCTYPE html>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<html>
<head>
  <title>BrowserID Communication Frame</title>
  <meta charset="utf-8">
</head>
<body>
<script>
// Minimal communication iframe for BrowserID-NG
// This handles cross-origin communication between include.js and the broker

(function() {
  // jschannel-compatible message handler
  // The full implementation would track login state and notify RPs of changes

  var origin = null;
  var channel = null;

  window.addEventListener('message', function(event) {
    // Accept messages and respond to jschannel protocol
    try {
      var msg = JSON.parse(event.data);

      // jschannel uses a specific message format
      if (msg.method === '__ready') {
        // Respond that we're ready
        event.source.postMessage(JSON.stringify({
          id: msg.id,
          result: true
        }), event.origin);
      }
    } catch (e) {
      // Not a JSON message or not for us
    }
  });
})();
</script>
</body>
</html>
