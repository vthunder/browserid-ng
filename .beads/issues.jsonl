{"id":"BID-1","title":"Implement full communication_iframe for cross-origin state sync","description":"The communication_iframe is currently a minimal stub that just prevents 404 errors. It needs to be fleshed out to properly handle cross-origin login state synchronization.\n\nThe iframe sits hidden on every page that includes `include.js` and should:\n\n1. **Detect existing sessions** - Check if user is already authenticated with the broker when page loads\n2. **Notify of login/logout** - Trigger `onlogout` callbacks on all open tabs when user logs out from broker or another site\n3. **Enable `onmatch` callback** - Fire `navigator.id.watch({ onmatch: ... })` when existing session matches\n\nCurrently located at: `browserid-broker/static/communication_iframe.html`\n\nReference: Original Persona used jschannel for the cross-origin messaging protocol.","acceptance_criteria":"- [ ] Communication iframe properly initializes jschannel connection with include.js\n- [ ] Existing broker session is detected on page load\n- [ ] Login events are broadcast to all tabs with include.js loaded\n- [ ] Logout events are broadcast to all tabs\n- [ ] `onmatch` callback fires when session exists","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-26T21:47:03.172494+01:00","updated_at":"2025-12-26T21:47:03.172494+01:00"}
{"id":"BID-2","title":"Port browserid communication_iframe with localStorage keypair model","description":"Adopt the original browserid architecture for the communication_iframe and related client-side code. This includes porting the localStorage keypair storage model instead of generating fresh keypairs each time.\n\n## Files to port (from static_resources.js communication_iframe.js bundle):\n\n### Core infrastructure\n- common/js/browserid.js - Core namespace\n- common/js/lib/jschannel.js - Already in include.js\n- common/js/lib/tinyscore.js - Utility library (underscore-like)\n- common/js/lib/hub.js - Event hub\n- common/js/lib/micrajax.js - XHR library\n- common/js/javascript-extensions.js - JS extensions\n- common/js/mediator.js - Mediator pattern\n- common/js/helpers.js - Helper functions\n- common/js/class.js - OOP helpers\n- common/js/xhr_transport.js - XHR transport\n\n### Modules\n- common/js/modules/module.js - Module base\n- common/js/modules/xhr.js - XHR module\n\n### Models\n- common/js/models/models.js - Models base\n- common/js/models/user-context.js - User context\n- common/js/models/network-context.js - Network context\n- common/js/models/rp_info.js - RP info\n- common/js/models/interaction_data.js - Interaction data\n\n### Core logic (need crypto updates for Ed25519)\n- common/js/storage.js - LocalStorage abstraction (24KB)\n- common/js/network.js - Network layer (22KB)\n- common/js/crypto-loader.js - Crypto loading\n- common/js/provisioning.js - Key provisioning\n- common/js/user.js - User management (60KB) - THE BIG ONE\n\n### Entry point\n- dialog/js/misc/internal_api.js - Internal API\n- communication_iframe/start.js - The actual iframe logic\n\n## Key architectural change\nOriginal uses jwcrypto with DSA/RSA. We use Ed25519 with Web Crypto API.\nNeed to update crypto-loader.js, provisioning.js, and parts of user.js.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-26T22:46:58.034379+01:00","updated_at":"2025-12-26T22:46:58.034379+01:00"}
